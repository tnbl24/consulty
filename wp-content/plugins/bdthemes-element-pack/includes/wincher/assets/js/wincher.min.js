!function(t){"use strict";console.info("%cWincher Loaded.","color:green");const e={DashboardData:function(){return{keywords:[],tracked_keywords_count:0}},formatDateString:function(t){return new Date(t).toLocaleDateString("en-US",{day:"numeric",month:"short"})},getWebsiteFaveicon:function(t){return"https://www.google.com/s2/favicons?sz=64&domain_url="+t},dashboardChart:function(t,e,n="",a="bar"){const o=new Chart(t,{type:a,data:e,options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0}},plugins:{legend:{display:!0,position:"top"},title:{display:!0,text:n}}}});window.addEventListener("afterprint",()=>{o.resize()}),window.addEventListener("onResize",()=>{o.resize()})},trafficChart:function(t){let n=[],a=[];t.forEach(t=>{n.push(e.formatDateString(t.datetime)),a.push(t.value)}),n=n.slice(Math.max(n.length-30,0)),a=a.slice(Math.max(a.length-30,0));const o=document.getElementById("bdt-ep-wincher-traffic-graph").getContext("2d");var r=o.createLinearGradient(500,0,100,0);r.addColorStop(0,"#0BB3E5"),r.addColorStop(1,"#20E2AD");var i=o.createLinearGradient(500,0,100,0);i.addColorStop(0,"rgba(11, 179, 229, 0.30)"),i.addColorStop(1,"rgba(32, 226, 173, 0.30)");let d={labels:n,datasets:[{label:"Traffic",data:a,backgroundColor:i,borderWidth:2,borderColor:r,hoverBorderColor:"red",pointColor:"#3287f0",fill:!0,dash_border:"",background_fill:"yes",borderDash:[],pointStyle:"circle",pointBorderColor:r,pointBorderWidth:1.5,pointBackgroundColor:r,pointHoverBackgroundColor:r,pointHoverBorderColor:r,tension:.5}]};e.dashboardChart(o,d,"Estimated Traffic","line")},trafficValueChart:function(t){let n=[],a=[];t.forEach(t=>{n.push(e.formatDateString(t.datetime)),a.push(t.value)}),n=n.slice(Math.max(n.length-30,0)),a=a.slice(Math.max(a.length-30,0));const o=document.getElementById("bdt-ep-wincher-traffic-value-graph").getContext("2d");var r=o.createLinearGradient(500,0,100,0);r.addColorStop(0,"#0BB3E5"),r.addColorStop(1,"#20E2AD");var i=o.createLinearGradient(500,0,100,0);i.addColorStop(0,"rgba(11, 179, 229, 0.30)"),i.addColorStop(1,"rgba(32, 226, 173, 0.30)");let d={labels:n,datasets:[{label:"Traffic Value",data:a,backgroundColor:i,borderWidth:2,borderColor:r,hoverBorderColor:"red",pointColor:"#3287f0",fill:!0,dash_border:"",background_fill:"yes",borderDash:[],pointStyle:"circle",pointBorderColor:r,pointBorderWidth:1.5,pointBackgroundColor:r,pointHoverBackgroundColor:r,pointHoverBorderColor:r,tension:.5}]};e.dashboardChart(o,d,"Traffic Value","line")},trafficAvgPositionChart:function(t){let n=[],a=[];t.forEach(t=>{n.push(e.formatDateString(t.datetime)),a.push(t.value)}),n=n.slice(Math.max(n.length-30,0)),a=a.slice(Math.max(a.length-30,0));const o=document.getElementById("bdt-ep-wincher-traffic-average-position-graph").getContext("2d");var r=o.createLinearGradient(500,0,100,0);r.addColorStop(0,"#0BB3E5"),r.addColorStop(1,"#20E2AD");var i=o.createLinearGradient(500,0,100,0);i.addColorStop(0,"rgba(11, 179, 229, 0.30)"),i.addColorStop(1,"rgba(32, 226, 173, 0.30)");let d={labels:n,datasets:[{label:"Position Value",data:a,backgroundColor:i,borderWidth:2,borderColor:r,hoverBorderColor:"red",pointColor:"#3287f0",fill:!0,dash_border:"",background_fill:"yes",borderDash:[],pointStyle:"circle",pointBorderColor:r,pointBorderWidth:1.5,pointBackgroundColor:r,pointHoverBackgroundColor:r,pointHoverBorderColor:r,tension:.5}]};e.dashboardChart(o,d,"Average Position","line")},shareVoiceChart:function(t){let n=[],a=[];t.forEach(t=>{n.push(e.formatDateString(t.datetime)),a.push(t.value)}),n=n.slice(Math.max(n.length-30,0)),a=a.slice(Math.max(a.length-30,0));const o=document.getElementById("bdt-ep-wincher-share-voice-graph").getContext("2d");var r=o.createLinearGradient(500,0,100,0);r.addColorStop(0,"#0BB3E5"),r.addColorStop(1,"#20E2AD");var i=o.createLinearGradient(500,0,100,0);i.addColorStop(0,"rgba(11, 179, 229, 0.30)"),i.addColorStop(1,"rgba(32, 226, 173, 0.30)");let d={labels:n,datasets:[{label:"Value",data:a,backgroundColor:i,borderWidth:2,borderColor:r,hoverBorderColor:"red",pointColor:"#3287f0",fill:!0,dash_border:"",background_fill:"yes",borderDash:[],pointStyle:"circle",pointBorderColor:r,pointBorderWidth:1.5,pointBackgroundColor:r,pointHoverBackgroundColor:r,pointHoverBorderColor:r,tension:.5}]};e.dashboardChart(o,d,"Share Of Voice","line")},keywordCountHistoryChart:function(t){let n=[],a=[];t.forEach(t=>{n.push(e.formatDateString(t.datetime)),a.push(t.value||0)}),n=n.slice(Math.max(n.length-30,0)),a=a.slice(Math.max(a.length-30,0));const o=document.getElementById("bdt-ep-wincher-keyword-count-history").getContext("2d");var r=o.createLinearGradient(500,0,100,0);r.addColorStop(0,"#0BB3E5"),r.addColorStop(1,"#20E2AD");var i=o.createLinearGradient(500,0,100,0);i.addColorStop(0,"rgba(11, 179, 229, 0.30)"),i.addColorStop(1,"rgba(32, 226, 173, 0.30)");const d=new Chart(o,{type:"bar",data:{labels:n,datasets:[{label:"Keywords",data:a,backgroundColor:i,borderWidth:2,borderColor:r,pointColor:"#3287f0",fill:!0,dash_border:"",background_fill:"yes",borderDash:[],pointStyle:"circle",pointBorderColor:r,pointBorderWidth:1.5,pointBackgroundColor:r,pointHoverBackgroundColor:r,pointHoverBorderColor:r,tension:.5}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0}},plugins:{legend:{display:!1}},scales:{xAxis:{display:!1},yAxis:{display:!1}}}});window.addEventListener("afterprint",()=>{d.resize()}),window.addEventListener("onResize",()=>{d.resize()})},rankingPagesHistoryChart:function(t){let n=[],a=[];t.forEach(t=>{n.push(e.formatDateString(t.datetime)),a.push(t.value||0)}),n=n.slice(Math.max(n.length-30,0)),a=a.slice(Math.max(a.length-30,0));const o=document.getElementById("bdt-ep-wincher-ranking-pages-history").getContext("2d");var r=o.createLinearGradient(500,0,100,0);r.addColorStop(0,"#0BB3E5"),r.addColorStop(1,"#20E2AD");var i=o.createLinearGradient(500,0,100,0);i.addColorStop(0,"rgba(11, 179, 229, 0.30)"),i.addColorStop(1,"rgba(32, 226, 173, 0.30)");const d=new Chart(o,{type:"line",data:{labels:n,datasets:[{label:"Pages",data:a,backgroundColor:i,borderWidth:2,borderColor:r,hoverBorderColor:"red",pointColor:"#3287f0",fill:!0,dash_border:"",background_fill:"yes",borderDash:[],pointStyle:"circle",pointBorderColor:r,pointBorderWidth:1.5,pointBackgroundColor:r,pointHoverBackgroundColor:r,pointHoverBorderColor:r,tension:.5}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0}},plugins:{legend:{display:!1}},scales:{xAxis:{display:!1},yAxis:{display:!1}}}});window.addEventListener("afterprint",()=>{d.resize()}),window.addEventListener("onResize",()=>{d.resize()})},numberToKconverter:function(t){return t>999&&t<=999999?t=(t/1e3).toFixed(1)+"K":t>999999&&(t=(t/1e6).toFixed(1)+"M"),t},tokenRequest:function(e){t.ajax({url:EP_WINCHER_CONFIG.apiBaseUrl+"/token",method:"GET",data:{code:e},success:function(t){},error:function(t){console.log(t)}})},getStatus:function(){t.ajax({url:EP_WINCHER_CONFIG.apiBaseUrl+"/status",method:"GET",success:function(e){let n=e.domains,a="";n.forEach(t=>{a+=`<option value="${t.id}">${t.domain}</option>`}),t("#bdt-wincher-domains").append(a),t("#bdt-wincher-domains option[value='"+EP_WINCHER_CONFIG.domain_id+"']").attr("selected","selected");let o=window.location.hostname,r=0;n.forEach(t=>{t.domain==o&&(r=t.id)})},error:function(t){console.log(t)}})},getCompetitionValue:function(e){function n(t){return t>=.75?"High":t>=.5?"Medium":"Low"}const a=e;Promise.all(a.map((function(t){return new Promise((e,n)=>{setTimeout(()=>{const n=t.competition&&t.competition.value?t.competition.value:0;e(n)},500)})}))).then(e=>{const a=e.map(n),o=a.sort((t,e)=>a.filter(e=>e===t).length-a.filter(t=>t===e).length).pop();t("#bdt-wincher-competition-level").html(o)}).catch(t=>{console.error("Error fetching competition values:",t)})},getTrafficLoss:function(e){e=e.slice(0,10);let n="";e.forEach(t=>{let e=t.ranking.position&&t.ranking.position.value?t.ranking.position.value:0,a=t.ranking.traffic&&t.ranking.traffic.value?t.ranking.traffic.value:0,o=t.ranking.traffic&&t.ranking.traffic.change?t.ranking.traffic.change:0;n+=`<tr>\n                            <td>${t.keyword}</td>\n                            <td class="bdt-text-center">${e}</td>\n                            <td class="bdt-flex bdt-flex-middle bdt-flex-right">\n                                <span>${a}</span>\n                                <span class="bdt-flex bdt-flex-middle bdt-text-danger bdt-margin-small-left">\n                                    ${o}\n                                    <span class="bdt-text-danger" bdt-icon="icon: triangle-down; ratio: 1"></span>\n                                </span>\n                            </td>\n                        </tr>`}),t("#bdt-wincher-traffic-loss-list").html(n)},trafficOpportunities:function(e){e=e.slice(0,10);let n="";e.forEach(t=>{let e=t.ranking.position&&t.ranking.position.value?t.ranking.position.value:0,a=(t.ranking.traffic&&t.ranking.traffic.value&&t.ranking.traffic.value,t.ranking.traffic&&t.ranking.traffic.change?t.ranking.traffic.change:0);n+=`<tr>\n                            <td>${t.keyword}</td>\n                            <td class="bdt-text-center">${e}</td>\n                            <td class="bdt-flex bdt-flex-middle bdt-flex-right">\n                                <span>${a}</span>\n                            </td>\n                        </tr>`}),t("#bdt-wincher-traffic-opportunities-list").html(n)},getKeywords:function(){t.ajax({url:EP_WINCHER_CONFIG.apiBaseUrl+"/keywords",method:"GET",data:{id:EP_WINCHER_CONFIG.domain_id},success:function(n){const a=n.filter(t=>t.ranking&&t.ranking.position&&t.ranking.position.value<=100);if(a.length){t("#bdt-wincher-ranking-keywords-count").html(a.length);let e="";a.slice(0,10).forEach(t=>{let n=t.ranking.position&&t.ranking.position.value?t.ranking.position.value:0,a=t.ranking.traffic&&t.ranking.traffic.value?t.ranking.traffic.value:0;t.ranking.traffic&&t.ranking.traffic.change&&t.ranking.traffic.change;e+=`<tr>\n                                <td>${t.keyword}</td>\n                                <td class="bdt-text-center">${n}</td>\n                                <td class="bdt-flex bdt-flex-middle bdt-flex-right">\n                                    <span class="bdt-flex bdt-flex-middle bdt-text-success bdt-margin-small-left">\n                                        ${a}\n                                        <span class="bdt-text-success" bdt-icon="icon: triangle-up; ratio: 1"></span>\n                                    </span>\n                                </td>\n                            </tr>`}),t("#bdt-wincher-ranking-keywords-list").html(e)}e.getCompetitionValue(n);const o=n.filter(t=>t.ranking&&t.ranking.position&&"DECLINED"==t.ranking.position.change_status);o.length&&e.getTrafficLoss(o);const r=n.filter(t=>t.ranking&&t.ranking.position&&t.ranking.position.value>=5&&t.ranking.position.value<=20);r.length&&e.trafficOpportunities(r),n.length&&t("#bdt-wincher-keywords-count").html(n.length);let i="";n.forEach(t=>{t.ranking&&"pages"in t.ranking&&t.ranking.pages;let n=t.volume&&"value"in t.volume?t.volume.value:0,a=t.search_intents,o="";a.length&&a.forEach(t=>{let e,n;n="bdt-label-default",e="I","NAVIGATIONAL"==t.intent&&(n="bdt-label-warning",e="N"),"COMMERCIAL"==t.intent&&(n="bdt-label-success",e="C"),"TRANSACTIONAL"==t.intent&&(n="bdt-label-success",e="T"),o+=`<span class="bdt-label ${n} bdt-border-rounded">${e}</span>`}),i+=`<tr>\n\t\t\t\t\t\t\t<td class="">${t.keyword}</td>\n                            <td class="bdt-text-center bdt-intents-row">${o}</td>\n\t\t\t\t\t\t\t<td class="bdt-text-center">${t.difficulty||1}</td>\n\t\t\t\t\t\t\t<td class="bdt-text-center">$ ${t.cpc&&"value"in t.cpc?t.cpc.value:0}</td>\n\t\t\t\t\t\t\t<td class="bdt-text-center">${e.numberToKconverter(n)}</td>\n\t\t\t\t\t\t\t<td class="bdt-text-right">${t.ranking.traffic&&"value"in t.ranking.traffic?t.ranking.traffic.value:0}</td>\n\t\t\t\t\t\t</tr>`}),t("#bdt-keywords-list").html(i),e.tablePagination()},error:function(t){console.log(t)}})},create_keyword:function(){t.ajax({url:EP_WINCHER_CONFIG.apiBaseUrl+"/keywords",method:"POST",data:{domain_id:EP_WINCHER_CONFIG.domain_id,keyword:"test"},success:function(t){},error:function(t){console.log(t)}})},getCompetitors:function(){t.ajax({url:EP_WINCHER_CONFIG.apiBaseUrl+"/competitors",method:"GET",data:{id:EP_WINCHER_CONFIG.domain_id},success:function(t){let e="";t.forEach(t=>{e+=`<div class="bdt-flex bdt-flex-middle bdt-flex-between bdt-competitors-name-wrap bdt-margin-top">\n                                <div class="bdt-flex bdt-flex-middle bdt-border-rounded bdt-competitors-name bdt-text-secondary">\n                                    \x3c!-- <svg xmlns="http://www.w3.org/2000/svg" id="Layer_1" data-name="Layer 1" viewBox="0 0 16 16">\n                                        <rect width="16" height="16" rx="1.18" style="fill:#fff" />\n                                        <polyline points="6.45 10.02 6.45 4.46 4.28 3.41 4.28 11.46 6.48 12.59 11.72 9.1 11.72 6.5 7.69 4.85 7.69 7.17 9.54 7.94 6.45 10.02" style="fill:#272e38" />\n                                    </svg> --\x3e\n                                    <span class="">${t.domain}</span>\n                                </div>\n                                <span>465</span>\n                            </div>`})},error:function(t){console.log(t)}})},getCompetitorsSummaries(){t.ajax({url:EP_WINCHER_CONFIG.apiBaseUrl+"/competitors-ranking-summaries",method:"GET",data:{id:EP_WINCHER_CONFIG.domain_id},success:function(n){let a="";n.forEach(t=>{let n=e.numberToKconverter(t.ranking.traffic.value||0),o=e.getWebsiteFaveicon(t.domain),r=0;t.ranking.traffic.value&&(r=t.ranking.traffic.value),r>100&&(r=100);let i="";r>=0&&r<=25&&(i="bdt-background-0"),r>25&&r<=50&&(i="bdt-background-25"),r>50&&r<=75&&(i="bdt-background-50"),r>75&&r<=100&&(i="bdt-background-75"),a+=`<div class="bdt-flex bdt-flex-middle bdt-flex-between bdt-competitors-name-wrap bdt-margin-top">\n                                <div class = "bdt-flex bdt-flex-middle bdt-border-rounded bdt-competitors-name bdt-text-secondary ${i}"\n                                style = "width:${r}%;" >\n                                   <div class="bdt-wincher-tc-logo"><img src="${o}"/></div>\n                                    <span class="">${t.domain}</span>\n                                </div>\n                                <span>${n}</span>\n                            </div>`}),t("#bdt-wincher-competitor-list").html(a)},error:function(t){console.log(t)}})},getWebsiteData:function(){t.ajax({url:EP_WINCHER_CONFIG.apiBaseUrl+"/website-data",method:"POST",data:{id:EP_WINCHER_CONFIG.domain_id},success:function(n){var a=e.DashboardData();let o=n.keyword_count?n.keyword_count:0;a.tracked_keywords_count=o;let r=n.ranking.traffic.change?n.ranking.traffic.change:0;a.traffic_value=r;let i=n.ranking.traffic.value?n.ranking.traffic.value:0;a.estimated_traffic=i;let d=n.ranking.avg_position.value?n.ranking.avg_position.value:0;a.ranking_avg_position=d;let l=n.ranking.avg_position.change?n.ranking.avg_position.change:0;a.ranking_avg_position_change=l;let s=n.ranking.share_of_voice?n.ranking.share_of_voice:"-";a.share_of_voice=s;let c=n.ranking.ranking_pages.value?n.ranking.ranking_pages.value:0;a.ranking_pages=c,n.ranking.traffic.history&&e.trafficChart(n.ranking.traffic.history),n.ranking.traffic_value.history&&e.trafficValueChart(n.ranking.traffic_value.history),n.ranking.avg_position.history&&e.trafficAvgPositionChart(n.ranking.avg_position.history),null==n.ranking.share_of_voice&&e.shareVoiceChart([{datetime:new Date,value:0}]),null!==n.ranking.share_of_voice&&n.ranking.share_of_voice.history&&e.shareVoiceChart(n.ranking.share_of_voice.history),n.keyword_count_history&&e.keywordCountHistoryChart(n.keyword_count_history),n.ranking.ranking_pages.history&&e.rankingPagesHistoryChart(n.ranking.ranking_pages.history),n.competitor_count,t("#bdt_keyword_count").html(a.tracked_keywords_count),t("#bdt_estimated_traffic").html(a.estimated_traffic),t("#bdt_traffic_value").html(a.traffic_value),t("#bdt_avg_position").html(a.ranking_avg_position),t("#bdt_share_of_voice").html(a.share_of_voice),t("#bdt_ranking_pages").html(a.ranking_pages)},error:function(t){console.log(t)}})},saveDomain:function(e){t.ajax({url:EP_WINCHER_CONFIG.apiBaseUrl+"/save-domain",method:"POST",data:{domain_id:e},success:function(t){t&&location.reload()},error:function(t){console.log(t)}})},dashBoardReport:function(t){},tablePagination:function(){var e=t("#bdt-wincher-keywords tbody tr"),n=Math.ceil(e.length/10);function a(t){var n=10*(t-1),a=n+10;e.hide().slice(n,a).show()}a(1),function(){for(var e=t("#bdt-wk-pagination-container"),o=t('<ul class="bdt-pagination bdt-flex-right"></ul>'),r=1;r<=n;r++){var i=t("<li>"+r+"</li>");1===r&&i.addClass("bdt-active"),o.append(i)}e.html(o),o.on("click","li",(function(){a(parseInt(t(this).text(),10)),o.find("li").removeClass("bdt-active"),t(this).addClass("bdt-active")}))}()},init:function(){t("#wincher-auth-save").on("click",(function(n){t.ajax({url:EP_WINCHER_CONFIG.apiBaseUrl+"/authorization-url",method:"GET",success:function(t){let n;!function(t,e){if(n&&!n.closed)return void n.focus();n=window.open(t,"Login Popup","width=500,height=700,title=Wincher_login");const a=setInterval(()=>{n.closed&&(clearInterval(a),console.log("Popup closed"),location.reload())},1e3);window.addEventListener("message",async t=>{t.data&&"wincher:oauth:success"===t.data.type?(await e({params:{code:t.data.code}}),n.close()):t.data&&"wincher:oauth:error"===t.data.type&&(console.error("OAuth error:",t.data.error),n.close())})}(t,async t=>{e.tokenRequest(t.params.code)})},error:function(t){console.log(t)}})})),t(document).on("change","#bdt-wincher-domains",(function(n){n.preventDefault();let a=t(this).val();e.saveDomain(a)})),t(document).on("click","#bdt-wincher-keyword-create",(function(t){t.preventDefault(),e.create_keyword()})),1==EP_WINCHER_CONFIG.tokenStatus?(e.getStatus(),e.getKeywords(),e.getCompetitorsSummaries(),e.getWebsiteData()):(t("#bdt-wincher-data").remove(),t("#bdt-wincher-login").removeClass("bdt-hidden"))}};t(document).ready((function(){e.init()})),t(document).ready((function(){var e=0;t(".bdt-ep-tab-switcher").on("click keypress",(function(n){if("keypress"===n.type&&13===n.which||"click"===n.type){var a=t(this).data("tab-index");t(".bdt-ep-tab-switcher").removeClass("bdt-active"),t(this).addClass("bdt-active"),a!=e&&t("#bdt-ep-graph-tabs-container .bdt-ep-tab-container").each((function(){if(t(this).data("tab-index")==a)return t(".bdt-ep-tab-container").addClass("bdt-hidden"),t(this).removeClass("bdt-hidden"),void(e=t(this).data("tab-index"))}))}}))}))}(jQuery);